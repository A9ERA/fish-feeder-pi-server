# Feeder Video Recording System

## üìñ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏õ‡∏•‡∏≤ (Feeder Service)

## üé¨ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `feeder_service.start()` ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á Raspberry Pi Camera Module
- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏•‡∏≠‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏õ‡∏•‡∏≤ (12+ ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)

### ‡∏Å‡∏≤‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
- ‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
- ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå H264 ‡πÄ‡∏õ‡πá‡∏ô MP4 ‡∏î‡πâ‡∏ß‡∏¢ FFmpeg
- ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå temporary H264 

## üìÅ ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå

### ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå
```
src/data/history/feeder-vdo/
```

### ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå
```
{uuid4}-{yyyy-mm-dd-hh-mm-ss}.mp4
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
```
5298ef37-2d85-4270-9790-94849509581c-2025-06-21-20-17-57.mp4
```

## ‚öôÔ∏è ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏ö‡∏ö

### Dependencies
- **picamera2**: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á
- **ffmpeg**: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á FFmpeg ‡∏ö‡∏ô Raspberry Pi
```bash
sudo apt update
sudo apt install ffmpeg -y
```

## üé• ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
- **Resolution**: 500x500 pixels (streaming)
- **Frame Rate**: 30 FPS
- **Bitrate**: 0.5 Mbps (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà)
- **Encoder**: H264
- **Container**: MP4

### ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå temporary H264
2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏î‡πâ‡∏ß‡∏¢ Picamera2 H264Encoder
3. ‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
4. ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô MP4 ‡∏î‡πâ‡∏ß‡∏¢ FFmpeg
5. ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå temporary

## üìä ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### CSV History
‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô CSV history ‡∏û‡∏£‡πâ‡∏≠‡∏° **video_file column ‡πÉ‡∏´‡∏°‡πà**:

```csv
timestamp,amount_g,actuator_up_s,actuator_down_s,auger_duration_s,blower_duration_s,status,message,video_file
2025-06-21 20:30:15,25,3.0,3.0,8.0,5.0,success,Feeding process completed successfully,a1b2c3d4-e5f6-7890-abcd-ef1234567890-2025-06-21-20-30-15.mp4
2025-06-21 18:45:22,15,2.0,2.0,6.0,4.0,success,Feeding process completed successfully,f9e8d7c6-b5a4-3210-9876-543210abcdef-2025-06-21-18-45-22.mp4
```

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: video_file ‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå (‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà full path) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ CSV ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢

### API Response
```json
{
  "status": "success",
  "message": "Feeding process completed successfully",
  "feed_size": 10,
  "video_file": "/path/to/video.mp4",
  "total_duration": 12
}
```

## üîß ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏**: ‡πÑ‡∏ü‡∏•‡πå H264 ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô MP4
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ**:
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö FFmpeg: `ffmpeg -version`
2. ‡∏î‡∏π log ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå temporary H264

### ‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î 0 bytes
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (error ‡∏´‡∏£‡∏∑‡∏≠ interrupt)
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ**:
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö log error
2. ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏ô‡∏à‡∏ö

### ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏**: Camera module ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ**:
```bash
sudo raspi-config
# Interfacing Options > Camera > Yes
sudo reboot
```

### Multiple Camera Instance Error
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏™‡∏£‡πâ‡∏≤‡∏á VideoStreamService ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ**: ‡πÉ‡∏ä‡πâ instance ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### Mock Mode (Development)
```python
# ‡∏ï‡∏±‡πâ‡∏á environment variable
export ENABLE_CAMERA=false

# ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ô code
USE_MOCK_CAMERA = True
```

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô Pi
```bash
cd fish-feeder-pi-server
python test_feeder_video.py
```

## üìù ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô API

### ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏õ‡∏•‡∏≤ (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠)
```bash
curl -X POST http://localhost:5000/api/feeder/start \
  -H "Content-Type: application/json" \
  -d '{
    "feed_size": 10,
    "actuator_up": 2,
    "actuator_down": 2,
    "auger_duration": 5,
    "blower_duration": 3
  }'
```

### Response
```json
{
  "status": "success",
  "message": "Feeding process completed successfully",
  "feed_size": 10,
  "video_file": "/home/pi/fish-feeder-pi-server/src/data/history/feeder-vdo/uuid-timestamp.mp4",
  "total_duration": 12,
  "steps_completed": [
    "Actuator up: 2s",
    "Actuator down: 2s",
    "Auger forward & Blower (simultaneous): 5s & 3s"
  ]
}
```

## üéØ Features

### ‚úÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
- ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡πâ‡∏≠‡∏ô‡∏õ‡∏•‡∏≤
- ‚úÖ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏ß‡∏¢ UUID + timestamp
- ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô MP4 ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ
- ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô CSV history
- ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‚úÖ Mock mode ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö development

### üîÑ ‡∏≠‡∏≤‡∏à‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
- üìä Video analytics (motion detection)
- üîÑ Video compression options
- üì° Auto upload to cloud storage
- üì± Real-time streaming during feeding
- üéõÔ∏è Manual recording controls

---
**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πâ‡∏≠‡∏á Raspberry Pi ‡πÅ‡∏•‡∏∞ FFmpeg ‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á 